<?xml version="1.0" encoding="UTF-8"?>

<!-- ?web.items&web.sections&web.panels -->
<!-- https://community.developer.atlassian.com/t/get-url-for-web-resource-specified-in-atlassian-plugin-xml-using-js/26985/2 -->
<!-- https://developer.atlassian.com/server/jira/platform/adding-content-to-the-jira-view-issue-page/ -->
<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">

  <plugin-info>
    <description>${project.description}</description>  
    <version>${project.version}</version>  
    <vendor name="${project.organization.name}" url="${project.organization.url}"/>  
    <param name="plugin-icon">images/pluginIcon.png</param>  
    <param name="plugin-logo">images/pluginLogo.png</param>
    <param name="configure.url">/plugins/servlet/ws-slink-statuspage/admin</param>
  </plugin-info>

  <!-- add our i18n resource -->
  <resource type="i18n" name="i18n" location="status-page-plugin"/>  

  <!-- add our web resources -->
  <web-resource key="status-page-plugin-resources" name="status-page-plugin web resources"> 
    <dependency>com.atlassian.auiplugin:ajs</dependency>  
    <resource type="download" name="status-page-plugin.css" location="/css/status-page-plugin.css"/>  
    <resource type="download" name="status-page-plugin.js" location="/js/status-page-plugin.js"/>  
    <resource type="download" key="images-resource" name="images/" location="images/"> 
      <param name="allow-public-use" value="true"/> 
    </resource>  
    <resource key="statuspage-icon" name="statuspage.png" type="download" location="images/statuspage-32.png"> 
      <param name="content-type" value="image/png"/>  
      <param name="allow-public-use" value="true"/> 
    </resource>  
    <context>status-page-plugin</context> 
  </web-resource>  

  <issue-tabpanel key="incident-tab-panel" name="Incident Tab Panel" i18n-name-key="incident-tab-panel.name" class="ws.slink.statuspage.panel.IncidentTabPanel">
    <description key="incident-tab-panel.description">Incident Tab Panel Plugin</description>
    <label key="incident-tab-panel.label"/>  
    <order>1000</order>  
    <resource type="velocity" name="view" location="templates/incident-tab-panel.vm"/>  
    <supports-ajax-load>true</supports-ajax-load>
  </issue-tabpanel>
  <web-panel name="Incident Glance Panel"
             i18n-name-key="incident-glance-panel.name"
             key="incident-glance-panel"
             location="atl.jira.view.issue.right.context"
             weight="1">
    <description key="incident-glance-panel.description">Incident Glance Panel Plugin</description>
    <conditions type="AND">
      <condition class="ws.slink.statuspage.condition.IncidentsEnabledCondition"/>
      <condition class="ws.slink.statuspage.condition.IncidentAssignedCondition"/>
      <condition class="ws.slink.statuspage.condition.IncidentViewerCondition"/>
    </conditions>
    <context-provider class="ws.slink.statuspage.context.GlancePanelContextProvider"/>
    <resource name="view" type="velocity" location="templates/incident-glance-panel.vm"/>
  </web-panel>
  <webwork1 key="incident-create-action" name="Create Incident" class="java.lang.Object">
    <actions>
      <action name="ws.slink.statuspage.action.CreateIncident" alias="CreateIncident">
        <view name="input">/templates/incident-create.vm</view>
      </action>
    </actions>
  </webwork1>
  <web-item name="IncidentButton" i18n-name-key="incident-button.name" key="incident-button" section="jira.issue.tools" weight="10">
    <description key="incident-button.description">Incident Button Plugin</description>
    <conditions type="AND">
      <condition class="ws.slink.statuspage.condition.IncidentsEnabledCondition" />
      <condition class="ws.slink.statuspage.condition.NoIncidentAssignedCondition"/>
      <condition class="ws.slink.statuspage.condition.IncidentManagerCondition"/>
        <!--        <param name="param0" value="value0"/> -->
    </conditions>
    <!--    <styleClass>icon aui-icon aui-icon-small aui-iconfont-feedback</styleClass>-->
    <!--    <icon width="16" height="16">-->
    <!--      <link id="incident-button-icon">/download/resources/ws.slink.status-page-plugin:status-page-plugin-resources/statuspage.png</link>-->
    <!-- OK: http://localhost:2990/jira/download/batch/ws.slink.status-page-plugin:status-page-plugin-resources/statuspage.png -->
    <!--      <link linkId="incident-button-icon">https://cdn4.iconfinder.com/data/icons/logos-brands-5/24/statuspage-32.png</link>-->
    <!--    </icon>-->
    <tooltip key="incident-button.tooltip"/>
    <label key="incident-button.label"/>
    <link linkId="incident-create">/CreateIncident!default.jspa?id=${issue.id}</link>
    <!--    <styleClass>aui-list-item-link issueaction-link-issue opsbar-operations</styleClass>-->
    <styleClass>trigger-dialog</styleClass>
  </web-item>
  <web-resource name="Resources" key="resources">
    <resource name="incidentCreate.js" type="download" location="/js/incident-create.js"/>
    <context>jira.view.issue</context>
  </web-resource>


  <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~ admin ~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
  <web-resource key="status-page-plugin-admin-resources" name="statuspage-plugin admin web resources">
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <resource type="download" name="status-page-admin.css" location="/css/status-page-admin.css"/>
    <resource type="download" name="status-page-admin.js" location="/js/status-page-admin.js"/>
    <context>atl.admin</context>
  </web-resource>
  <servlet key="admin-servlet" class="ws.slink.statuspage.servlet.AdminServlet">
    <resource type="i18n" name="i18n" location="status-page-plugin"/>
    <url-pattern>/ws-slink-statuspage/admin</url-pattern>
  </servlet>
  <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

  <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~ config ~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
  <web-resource key="status-page-plugin-config" name="statuspage-plugin config web resource">
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <resource type="download" name="status-page-config.js" location="/js/status-page-config.js"/>
    <resource type="download" name="status-page-config.css" location="/css/status-page-config.css"/>
    <context>status-page-plugin</context>
  </web-resource>
  <servlet key="config-servlet" class="ws.slink.statuspage.servlet.ConfigServlet">
    <resource type="i18n" name="i18n" location="status-page-plugin"/>
    <url-pattern>
      <!--  /customer-priority/config-->
      /project-config/*/ws-slink-statuspage
    </url-pattern>
  </servlet>
  <!-- ~~~~~~~~~~~~~~~~~~~~~~~ config menu ~~~~~~~~~~~~~~~~~~~~~~~ -->
  <web-section key="sp-item-cfg-section" location="atl.jira.proj.config" weight="1000">
    <conditions type="AND" >
      <condition class="ws.slink.statuspage.condition.IncidentsEnabledCondition"/>
      <condition class="ws.slink.statuspage.condition.PluginManagerCondition"/>
    </conditions>
  </web-section>
  <web-item key="sp-item-cfg" section="atl.jira.proj.config/sp-item-cfg-section">
    <description key="sp.config.menu.item.description" />
    <label key="sp.config.menu.item.label" />
    <link linkId="sp.config.menu.item.link">
      /plugins/servlet/project-config/$helper.project.key/ws-slink-statuspage
    </link>
  </web-item>
  <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->


  <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~ common ~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
  <rest key="rest" path="/ws-slink-statuspage" version="1.0">
    <description>provides REST resources for the admin/config UI</description>
  </rest>
  <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

</atlassian-plugin>

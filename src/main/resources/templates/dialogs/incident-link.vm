<form class="aui" action="LinkIncident.jspa" id="" method="post">
    <div class="form-body">
        <h2 class="dialog-title">$i18n.getText('incident-link-dialog.title')</h2>
        <div class="field-group">
            <label for="sp-link-page">$i18n.getText('incident-link-dialog.page-select.label')&nbsp;</label>
            <select class="select" name="page" id="sp-link-page" required="true" placeholder="select status page" />
        </div>
        <div class="field-group">
            <label for="sp-link-incident">$i18n.getText('incident-link-dialog.incident-select.label')&nbsp;</label>
            <select class="select" name="incident" id="sp-link-incident" required="true" placeholder="select incident" />
        </div>
        <input type="hidden" name="location" id="page-location" value="" />
        <input type="hidden" name="atl_token" value="${atl_token}" />
        <input type="hidden" name="id" value="$action.id" />
    </div>
    <div class="buttons-container form-footer">
        <div class="buttons">
            <button href="#" class="aui-button aui-button-primary cancel">$i18n.getText('incident-link-dialog.button-cancel')</button>
            <button class="aui-button button" id="incident-link-dialog-submit-button" type="submit">$i18n.getText('incident-link-dialog.button-link')</button>
        </div>
    </div>
</form>
<script>
    #include("/js/statuspage.js")
    #include("/js/incident-link-dialog.js")
    AJS.toInit(function() {
        // AJS.log("----> init");
        $pluginCommon.buttonBusy('incident-link-dialog-submit-button', true);
        $incidentLinkDialog.loadPages('sp-link-page', 'sp-link-incident');

        AJS.$('#sp-link-page').change(function(){
            let pageId = $(this).val();
            $pluginCommon.buttonBusy('incident-link-dialog-submit-button', true);
            $incidentLinkDialog.loadIncidents(pageId, 'sp-link-incident');
        })
    });
</script>
